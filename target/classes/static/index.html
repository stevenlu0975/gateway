<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
</head>
<body>
  <div class="content">
    <p style="text-align:center">
    <form enctype = "multipart/form-data">
      <input type = "file" name = "file" size = "50" id="file"/>
      <br />
      <input type = "button" value = "Upload File" id="submit"/>
    </form>
    <a class="btn btn-success" href="/get" role="button">開始</a>
    </p>
  </div>
  <script>
    const uploadCall = async () => {
      try {
        console.log("Uploading file...");
        const fileInput = document.getElementById("file");
        const file = fileInput.files[0];

        if (!file) {
        	console.error("No file selected!");
        	return;
        }

        const formData = new FormData();
        formData.append("file", file);
        // Add headers
        const headers = {
          "Authorization": "eyJhbGciOiJIUzI1NiJ9.eyJVU0VSX0lEIjoiMTIzNDUiLCJleHAiOjE3MzM2NDIzMTZ9.qBbJYNUvhTcQAwYZwmJ0YO1KP61mb55DBGnWqx35iEI",  // Example authorization header// Replace with your custom header
        };
        const response = await fetch("/uploadpdf", {
          method: "POST",
          body: formData,
          headers: headers,
        });

        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const result = await response.json();
        console.log("File uploaded successfully:", result);
      } catch (error) {
        console.error("Error during file upload:", error);
      }
    };

    function throttleApiCall(uploadCall, delay){
      let lastCallTime = 0;

      return function(...args){
        const currentTime = new Date().getTime();

        if(currentTime - lastCallTime >= delay){
          uploadCall.apply(this, args);
          lastCallTime = currentTime;
        }
      }
    }
    const throttling = throttleApiCall(uploadCall, 10000); // ms
    document.getElementById("submit").addEventListener("click", throttling);
  </script>
</body>
</html>